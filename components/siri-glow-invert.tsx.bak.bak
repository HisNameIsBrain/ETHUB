"use client";

import * as React from "react";

type Props = {
  className?: string;
  reverse?: boolean;        // reverses color order (bright→dark vs dark→bright)
  rotateSec?: number;       // lower = faster
  blurPx?: number;
  insetPercent?: number;    // negative expands beyond bounds
  opacity?: number;         // 0..1
  colors?: string[];        // custom stops
  inner?: boolean;          // counter-rotating inner layer
  innerRotateSec?: number;  // lower = faster
};

const DEFAULT_COLORS_BRIGHT_TO_DARK = [
  "#fff200", "#ff8a00", "#ff007a", "#7a00ff",
  "#0048ff", "#00a2ff", "#00ffa2", "#a0ff00",
];

/* Base (clockwise outer, counter-clockwise inner) */
export function SiriGlow({
  className = "",
  reverse = false,
  rotateSec = 5.5,
  blurPx = 24,
  insetPercent = -18,
  opacity = 0.9,
  colors = DEFAULT_COLORS_BRIGHT_TO_DARK,
  inner = true,
  innerRotateSec = 7.2,
}: Props) {
  const stops = React.useMemo(() => (reverse ? [...colors].reverse() : colors), [colors, reverse]);
  const conic = React.useMemo(() => `conic-gradient(from 0deg, ${stops.join(", ")})`, [stops]);

  const outerStyle: React.CSSProperties = {
    inset: `${insetPercent}%`,
    filter: `blur(${blurPx}px)`,
    opacity,
    background: conic,
    animation: `siri-spin  ${rotateSec}s linear infinite`,
  };
  const innerStyle: React.CSSProperties = {
    inset: `${Math.max(insetPercent + 6, -2)}%`,
    filter: `blur(${Math.max(blurPx - 8, 8)}px)`,
    opacity: Math.min(opacity * 0.8, 1),
    background: conic,
    animation: `siri-spin-rev ${innerRotateSec}s linear infinite`,
    mixBlendMode: "screen",
  };

  return (
    <>
      <span aria-hidden className={`absolute rounded-full ${className}`} style={outerStyle} />
      {inner && <span aria-hidden className="absolute rounded-full" style={innerStyle} />}
      <style>{`
        @keyframes siri-spin { from { transform: rotate(0deg) } to { transform: rotate(360deg) } }
        @keyframes siri-spin-rev { from { transform: rotate(360deg) } to { transform: rotate(0deg) } }
      `}</style>
    </>
  );
}

/* Ring preset hugging the rim */
export function SiriGlowRing(props: Props) {
  return (
    <SiriGlow
      {...props}
      rotateSec={props.rotateSec ?? 4.2}
      innerRotateSec={props.innerRotateSec ?? 5.6}
      blurPx={props.blurPx ?? 14}
      insetPercent={props.insetPercent ?? -8}
      opacity={props.opacity ?? 0.9}
    />
  );
}

/* Inverted flow (counter-clockwise outer, clockwise inner) */
export function SiriGlowInvert({
  className = "",
  reverse = false,
  rotateSec = 5.5,
  blurPx = 24,
  insetPercent = -18,
  opacity = 0.9,
  colors = DEFAULT_COLORS_BRIGHT_TO_DARK,
  inner = true,
  innerRotateSec = 7.2,
}: Props) {
  const stops = React.useMemo(() => (reverse ? [...colors].reverse() : colors), [colors, reverse]);
  const conic = React.useMemo(() => `conic-gradient(from 0deg, ${stops.join(", ")})`, [stops]);

  const outerStyle: React.CSSProperties = {
    inset: `${insetPercent}%`,
    filter: `blur(${blurPx}px)`,
    opacity,
    background: conic,
    animation: `siri-spin-rev ${rotateSec}s linear infinite`,   // <- inverted
  };
  const innerStyle: React.CSSProperties = {
    inset: `${Math.max(insetPercent + 6, -2)}%`,
    filter: `blur(${Math.max(blurPx - 8, 8)}px)`,
    opacity: Math.min(opacity * 0.8, 1),
    background: conic,
    animation: `siri-spin    ${innerRotateSec}s linear infinite`, // <- inverted
    mixBlendMode: "screen",
  };

  return (
    <>
      <span aria-hidden className={`absolute rounded-full ${className}`} style={outerStyle} />
      {inner && <span aria-hidden className="absolute rounded-full" style={innerStyle} />}
      <style>{`
        @keyframes siri-spin { from { transform: rotate(0deg) } to { transform: rotate(360deg) } }
        @keyframes siri-spin-rev { from { transform: rotate(360deg) } to { transform: rotate(0deg) } }
      `}</style>
    </>
  );
}

/* Ring preset (inverted) */
export function SiriGlowRingInvert(props: Props) {
  return (
    <SiriGlowInvert
      {...props}
      rotateSec={props.rotateSec ?? 4.0}        // slightly faster “water” feel
      innerRotateSec={props.innerRotateSec ?? 5.2}
      blurPx={props.blurPx ?? 12}
      insetPercent={props.insetPercent ?? -8}
      opacity={props.opacity ?? 0.9}
    />
  );
}
