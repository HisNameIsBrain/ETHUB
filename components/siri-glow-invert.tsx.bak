"use client";
import * as React from "react";

type Props = {
  className?: string;
  reverse?: boolean;
  rotateSec?: number;
  innerRotateSec?: number;
  blurPx?: number;
  insetPercent?: number;
  opacity?: number;
  thicknessPx?: number;
  colors?: string[];
  inner?: boolean;
};

const COLORS_BRIGHT_TO_DARK = [
  "rgba(255,242,0,0.9)",
  "rgba(255,138,0,0.9)",
  "rgba(255,0,122,0.9)",
  "rgba(122,0,255,0.9)",
  "rgba(0,72,255,0.9)",
  "rgba(0,162,255,0.9)",
  "rgba(0,255,162,0.9)",
  "rgba(160,255,0,0.9)",
];

function ringMask(thicknessPx: number) {
  const t = Math.max(6, thicknessPx);
  const a = t - 1;
  return `radial-gradient(circle, transparent calc(50% - ${t}px), #000 calc(50% - ${a}px), #000 calc(50% + ${a}px), transparent calc(50% + ${t}px))`;
}

export function SiriGlowRingInvert({
  className = "",
  reverse = false,
  rotateSec = 3.8,
  innerRotateSec = 4.8,
  blurPx = 14,
  insetPercent = -6,
  opacity = 0.8,
  thicknessPx = 10,
  colors = COLORS_BRIGHT_TO_DARK,
  inner = true,
}: Props) {
  const stops = React.useMemo(() => (reverse ? [...colors].reverse() : colors), [colors, reverse]);
  const conic = React.useMemo(() => `conic-gradient(from 0deg, ${stops.join(", ")})`, [stops]);
  const mask = React.useMemo(() => ringMask(thicknessPx), [thicknessPx]);

  const outerStyle: React.CSSProperties = {
    inset: `${insetPercent}%`,
    filter: `blur(${blurPx}px)`,
    opacity,
    background: conic,
    animation: `siri-spin-rev ${rotateSec}s linear infinite`, // inverted
    WebkitMaskImage: mask,
    maskImage: mask,
    willChange: "transform",
  };
  const innerStyle: React.CSSProperties = {
    inset: `${Math.max(insetPercent + 4, -2)}%`,
    filter: `blur(${Math.max(blurPx - 6, 6)}px)`,
    opacity: Math.min(opacity * 0.85, 1),
    background: conic,
    animation: `siri-spin ${innerRotateSec}s linear infinite`, // inverted
    WebkitMaskImage: mask,
    maskImage: mask,
    mixBlendMode: "normal",
    willChange: "transform",
  };

  return (
    <>
      <span aria-hidden className={`absolute rounded-full ${className}`} style={outerStyle} />
      {inner && <span aria-hidden className="absolute rounded-full" style={innerStyle} />}
      <style>{`
        @keyframes siri-spin { from { transform: rotate(0deg) } to { transform: rotate(360deg) } }
        @keyframes siri-spin-rev { from { transform: rotate(360deg) } to { transform: rotate(0deg) } }
      `}</style>
    </>
  );
}
